# ğŸ¬ è§†é¢‘ç« èŠ‚ç”Ÿæˆå™¨ (Video Chapter Generator)

ä¸€ä¸ªåŸºäº **Node.js + PostgreSQL + çº¯HTML/CSS/JS** çš„å…¨æ ˆåº”ç”¨ï¼Œä½¿ç”¨ **Whisper AI** å’Œ **GPT-4 Turbo** è‡ªåŠ¨ä¸ºè§†é¢‘ç”Ÿæˆæ™ºèƒ½æ—¶é—´è½´ï¼ˆç« èŠ‚æ ‡è®°ï¼‰ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸ¯ å‰ç«¯åŠŸèƒ½
- âœ… **æ‰¹é‡è§†é¢‘ä¸Šä¼ **ï¼šæ”¯æŒæ‹–æ‹½ä¸Šä¼ ï¼Œæ”¯æŒå¤šç§è§†é¢‘æ ¼å¼ï¼ˆMP4, AVI, MKV, MOVç­‰ï¼‰
- âœ… **å®æ—¶è¿›åº¦æ˜¾ç¤º**ï¼šWebSocketå®æ—¶å±•ç¤ºè§†é¢‘å¤„ç†è¿›åº¦å’Œè€—æ—¶
- âœ… **æ™ºèƒ½æœç´¢**ï¼šæ”¯æŒå…³é”®å­—æœç´¢å’Œæ—¶é—´èŒƒå›´ç­›é€‰
- âœ… **çµæ´»åˆ†é¡µ**ï¼šå¯é€‰æ‹© 10/20/30/50/100/å…¨éƒ¨ æ¯é¡µæ˜¾ç¤ºæ•°é‡
- âœ… **å¤šæ ¼å¼å¯¼å‡º**ï¼šæ”¯æŒå¯¼å‡ºä¸º Excel, CSV, HTML, PDF, Markdown
- âœ… **ç°ä»£UIè®¾è®¡**ï¼šå“åº”å¼è®¾è®¡ï¼Œç¾è§‚æ˜“ç”¨

### ğŸ¤– AI å¤„ç†æµç¨‹
1. **éŸ³é¢‘æå–**ï¼šä½¿ç”¨ FFmpeg ä»è§†é¢‘ä¸­æå–éŸ³é¢‘
2. **è¯­éŸ³è½¬æ–‡å­—**ï¼šä½¿ç”¨ Whisper API å°†éŸ³é¢‘è½¬å½•ä¸ºæ–‡å­—
3. **æ™ºèƒ½åˆ†ç« **ï¼šä½¿ç”¨ Azure OpenAI GPT-4 Turbo æ™ºèƒ½åˆ†æå†…å®¹ç”Ÿæˆç« èŠ‚
4. **æ•°æ®å­˜å‚¨**ï¼šç« èŠ‚æ•°æ®å­˜å…¥ PostgreSQL æ•°æ®åº“
5. **å¤šæ¸ é“é€šçŸ¥**ï¼šé€šè¿‡ 4 ä¸ªæ¸ é“å‘é€å¤„ç†å®Œæˆé€šçŸ¥

### ğŸ“¢ é€šçŸ¥ç³»ç»Ÿ
æ”¯æŒ 4 ç§é€šçŸ¥æ¸ é“ï¼š
- ğŸ“± **WxPusher**ï¼ˆå¾®ä¿¡æ¨é€ï¼‰
- ğŸ“± **PushPlus**ï¼ˆå¤šå¹³å°æ¨é€ï¼‰
- ğŸ“§ **Resend Email**ï¼ˆé‚®ä»¶é€šçŸ¥ï¼‰
- ğŸ’¬ **Telegram Bot**ï¼ˆTelegramæ¶ˆæ¯ï¼‰

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åç«¯æŠ€æœ¯æ ˆ
- **Node.js + Express**ï¼šWeb æœåŠ¡å™¨
- **PostgreSQL**ï¼šå…³ç³»å‹æ•°æ®åº“
- **Whisper AI**ï¼šè¯­éŸ³è¯†åˆ«ï¼ˆæœ¬åœ°åŒ–éƒ¨ç½²ï¼‰
- **Azure OpenAI GPT-4 Turbo**ï¼šæ™ºèƒ½å†…å®¹åˆ†æ
- **FFmpeg**ï¼šéŸ³è§†é¢‘å¤„ç†
- **WebSocket**ï¼šå®æ—¶é€šä¿¡

### å‰ç«¯æŠ€æœ¯æ ˆ
- **çº¯ HTML/CSS/JavaScript**ï¼šæ— æ¡†æ¶ä¾èµ–
- **WebSocket**ï¼šå®æ—¶è¿›åº¦æ›´æ–°
- **ç°ä»£ CSS**ï¼šæ¸å˜èƒŒæ™¯ã€åŠ¨ç”»æ•ˆæœã€å“åº”å¼å¸ƒå±€

### æ•°æ®åº“è®¾è®¡
- **videos è¡¨**ï¼šå­˜å‚¨è§†é¢‘ä¿¡æ¯
- **chapters è¡¨**ï¼šå­˜å‚¨ç« èŠ‚ä¿¡æ¯
- **processing_logs è¡¨**ï¼šå­˜å‚¨å¤„ç†æ—¥å¿—

## ğŸ“¦ å®‰è£…å’Œéƒ¨ç½²

### 1. ç¯å¢ƒè¦æ±‚
- Node.js >= 14.x
- PostgreSQL >= 12.x
- FFmpeg
- Whisper æ¨¡å‹æ–‡ä»¶

### 2. å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
git clone <your-repo-url>
cd video-chapter-generator

# å®‰è£… Node.js ä¾èµ–
npm install
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
# æ•°æ®åº“é…ç½®
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=video_chapters
DATABASE_USER=postgres
DATABASE_PASSWORD=your_password

# æœåŠ¡å™¨é…ç½®
PORT=3000

# Whisper é…ç½®ï¼ˆæœ¬åœ°è·¯å¾„ï¼‰
WHISPER_MODEL_PATH=/path/to/whisper/models/ggml-large-v3-turbo.bin
WHISPER_EXECUTABLE_PATH=/path/to/whisper/main

# Azure OpenAI é…ç½®
AZURE_OPENAI_KEY=your_azure_key
AZURE_OPENAI_ENDPOINT=https://your-endpoint.openai.azure.com
AZURE_OPENAI_DEPLOYMENT=my-gpt4-turbo
AZURE_OPENAI_API_VERSION=2024-02-01

# é€šçŸ¥ç³»ç»Ÿé…ç½®ï¼ˆå¯é€‰ï¼‰
WXPUSHER_TOKEN=your_token
WXPUSHER_UID=your_uid
PUSHPLUS_TOKEN=your_token
RESEND_API_KEY=your_api_key
RESEND_TO_EMAIL=your@email.com
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id
```

### 4. åˆå§‹åŒ–æ•°æ®åº“

```bash
npm run init-db
```

### 5. å¯åŠ¨æœåŠ¡

```bash
# ç”Ÿäº§ç¯å¢ƒ
npm start

# å¼€å‘ç¯å¢ƒï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
npm run dev
```

è®¿é—®ï¼š`http://localhost:3000`

## ğŸ“– ä½¿ç”¨æŒ‡å—

### ä¸Šä¼ è§†é¢‘
1. ç‚¹å‡»ä¸Šä¼ åŒºåŸŸæˆ–æ‹–æ‹½è§†é¢‘æ–‡ä»¶
2. æ”¯æŒæ‰¹é‡é€‰æ‹©å¤šä¸ªè§†é¢‘
3. ç‚¹å‡»"å¼€å§‹ä¸Šä¼ "æŒ‰é’®
4. ä¸Šä¼ å®Œæˆåé€‰æ‹©æ˜¯å¦ç«‹å³å¤„ç†

### å¤„ç†è§†é¢‘
1. åœ¨è§†é¢‘åˆ—è¡¨ä¸­æ‰¾åˆ°å·²ä¸Šä¼ çš„è§†é¢‘
2. ç‚¹å‡»"å¼€å§‹å¤„ç†"æŒ‰é’®
3. å®æ—¶æŸ¥çœ‹å¤„ç†è¿›åº¦
4. ç­‰å¾…å¤„ç†å®Œæˆï¼ˆä¼šæ”¶åˆ°é€šçŸ¥ï¼‰

### æŸ¥çœ‹ç« èŠ‚
1. å¤„ç†å®Œæˆåï¼Œç‚¹å‡»"æŸ¥çœ‹ç« èŠ‚"æŒ‰é’®
2. åœ¨å¼¹çª—ä¸­æŸ¥çœ‹æ‰€æœ‰ç« èŠ‚ä¿¡æ¯
3. åŒ…æ‹¬ç« èŠ‚æ ‡é¢˜ã€æ—¶é—´èŒƒå›´ã€æè¿°ç­‰

### æœç´¢å’Œç­›é€‰
- **å…³é”®å­—æœç´¢**ï¼šè¾“å…¥æ–‡ä»¶åå…³é”®å­—
- **çŠ¶æ€ç­›é€‰**ï¼šæŒ‰å¤„ç†çŠ¶æ€ç­›é€‰
- **æ—¶é—´èŒƒå›´**ï¼šæŒ‰ä¸Šä¼ æ—¥æœŸç­›é€‰
- ç‚¹å‡»"æœç´¢"åº”ç”¨ç­›é€‰ï¼Œ"é‡ç½®"æ¸…ç©ºç­›é€‰

### å¯¼å‡ºæ•°æ®
é€‰æ‹©å¯¼å‡ºæ ¼å¼ï¼š
- **Excel**ï¼šå®Œæ•´çš„è¡¨æ ¼æ•°æ®ï¼ŒåŒ…å«è§†é¢‘å’Œç« èŠ‚
- **CSV**ï¼šçº¯æ–‡æœ¬è¡¨æ ¼ï¼Œæ–¹ä¾¿å¯¼å…¥å…¶ä»–å·¥å…·
- **HTML**ï¼šç¾è§‚çš„ç½‘é¡µæŠ¥å‘Š
- **PDF**ï¼šå¯æ‰“å°çš„æ–‡æ¡£
- **Markdown**ï¼šé€‚åˆæ–‡æ¡£å’Œç¬”è®°

## ğŸ”§ API æ¥å£æ–‡æ¡£

### ä¸Šä¼ è§†é¢‘
```
POST /api/upload
Content-Type: multipart/form-data

Body:
- videos: File[] (è§†é¢‘æ–‡ä»¶æ•°ç»„)

Response:
{
  "success": true,
  "message": "æˆåŠŸä¸Šä¼  2 ä¸ªè§†é¢‘",
  "videos": [...]
}
```

### å¤„ç†è§†é¢‘
```
POST /api/process
Content-Type: application/json

Body:
{
  "videoIds": [1, 2, 3]
}

Response:
{
  "success": true,
  "message": "å¼€å§‹å¤„ç† 3 ä¸ªè§†é¢‘"
}
```

### è·å–è§†é¢‘åˆ—è¡¨
```
GET /api/videos?page=1&limit=20&keyword=test&status=completed

Response:
{
  "success": true,
  "data": [...],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 100,
    "totalPages": 5
  }
}
```

### è·å–è§†é¢‘è¯¦æƒ…
```
GET /api/videos/:id

Response:
{
  "success": true,
  "data": {
    "id": 1,
    "original_name": "video.mp4",
    "chapters": [...]
  }
}
```

### åˆ é™¤è§†é¢‘
```
DELETE /api/videos/:id

Response:
{
  "success": true,
  "message": "è§†é¢‘å·²åˆ é™¤"
}
```

### å¯¼å‡ºæ•°æ®
```
POST /api/export
Content-Type: application/json

Body:
{
  "format": "excel",
  "filters": {
    "status": "completed"
  }
}

Response:
{
  "success": true,
  "downloadUrl": "/exports/chapters_1234567890.xlsx",
  "filename": "chapters_1234567890.xlsx"
}
```

## ğŸ”Œ WebSocket å®æ—¶é€šä¿¡

å®¢æˆ·ç«¯è¿æ¥åˆ° WebSocket åä¼šæ”¶åˆ°ä»¥ä¸‹ç±»å‹çš„æ¶ˆæ¯ï¼š

### çŠ¶æ€æ›´æ–°
```json
{
  "type": "status",
  "videoId": 1,
  "status": "processing",
  "message": "å¼€å§‹å¤„ç†è§†é¢‘..."
}
```

### è¿›åº¦æ›´æ–°
```json
{
  "type": "progress",
  "videoId": 1,
  "stage": "transcription",
  "progress": 60,
  "message": "è½¬å½•å®Œæˆï¼Œå¼€å§‹ç”Ÿæˆç« èŠ‚..."
}
```

### å®Œæˆé€šçŸ¥
```json
{
  "type": "completed",
  "videoId": 1,
  "chapters": 8
}
```

### é”™è¯¯é€šçŸ¥
```json
{
  "type": "error",
  "videoId": 1,
  "error": "å¤„ç†å¤±è´¥åŸå› "
}
```

## ğŸ“Š æ•°æ®åº“ç»“æ„

### videos è¡¨
```sql
CREATE TABLE videos (
  id SERIAL PRIMARY KEY,
  filename VARCHAR(500),
  original_name VARCHAR(500),
  file_path VARCHAR(1000),
  file_size BIGINT,
  duration NUMERIC(10, 2),
  status VARCHAR(50),
  upload_started_at TIMESTAMP,
  processing_started_at TIMESTAMP,
  processing_completed_at TIMESTAMP,
  error_message TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);
```

### chapters è¡¨
```sql
CREATE TABLE chapters (
  id SERIAL PRIMARY KEY,
  video_id INTEGER REFERENCES videos(id) ON DELETE CASCADE,
  chapter_index INTEGER,
  start_time NUMERIC(10, 2),
  end_time NUMERIC(10, 2),
  title VARCHAR(500),
  description TEXT,
  transcript TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);
```

## ğŸ¨ UI æˆªå›¾è¯´æ˜

åº”ç”¨åŒ…å«ä»¥ä¸‹ä¸»è¦ç•Œé¢ï¼š
- **é¦–é¡µ**ï¼šç»Ÿè®¡ä¿¡æ¯å±•ç¤ºï¼ˆæ€»è§†é¢‘æ•°ã€æ€»ç« èŠ‚æ•°ã€å¤„ç†ä¸­æ•°é‡ï¼‰
- **ä¸Šä¼ åŒºåŸŸ**ï¼šæ”¯æŒæ‹–æ‹½çš„æ–‡ä»¶ä¸Šä¼ ç•Œé¢
- **æœç´¢ç­›é€‰**ï¼šå…³é”®å­—ã€çŠ¶æ€ã€æ—¥æœŸèŒƒå›´ç­›é€‰
- **è§†é¢‘åˆ—è¡¨**ï¼šå¡ç‰‡å¼å±•ç¤ºï¼ŒåŒ…å«æ–‡ä»¶ä¿¡æ¯å’Œæ“ä½œæŒ‰é’®
- **è¿›åº¦æ˜¾ç¤º**ï¼šå®æ—¶è¿›åº¦æ¡å±•ç¤ºå¤„ç†çŠ¶æ€
- **ç« èŠ‚è¯¦æƒ…**ï¼šå¼¹çª—å±•ç¤ºå®Œæ•´ç« èŠ‚åˆ—è¡¨
- **å¯¼å‡ºé¢æ¿**ï¼šä¸€é”®å¯¼å‡ºå¤šç§æ ¼å¼

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

- **å¹¶å‘å¤„ç†**ï¼šæ”¯æŒå¤šä¸ªè§†é¢‘åŒæ—¶å¤„ç†
- **æ•°æ®åº“ç´¢å¼•**ï¼šå¯¹å¸¸ç”¨æŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•
- **WebSocket æ¨é€**ï¼šå‡å°‘è½®è¯¢ï¼Œå®æ—¶æ›´æ–°
- **æ–‡ä»¶æµå¤„ç†**ï¼šå¤§æ–‡ä»¶é‡‡ç”¨æµå¼å¤„ç†
- **åˆ†é¡µåŠ è½½**ï¼šé¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®

## ğŸ”’ å®‰å…¨æ€§

- **æ–‡ä»¶ç±»å‹éªŒè¯**ï¼šåªå…è®¸ä¸Šä¼ è§†é¢‘æ ¼å¼
- **æ–‡ä»¶å¤§å°é™åˆ¶**ï¼šå¯é…ç½®æœ€å¤§æ–‡ä»¶å¤§å°
- **SQL æ³¨å…¥é˜²æŠ¤**ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
- **CORS é…ç½®**ï¼šè·¨åŸŸè¯·æ±‚æ§åˆ¶
- **ç¯å¢ƒå˜é‡**ï¼šæ•æ„Ÿä¿¡æ¯ä¸ç¡¬ç¼–ç 

## ğŸ› æ•…éšœæ’é™¤

### æ•°æ®åº“è¿æ¥å¤±è´¥
- æ£€æŸ¥ PostgreSQL æ˜¯å¦è¿è¡Œ
- éªŒè¯ `.env` ä¸­çš„æ•°æ®åº“é…ç½®
- ç¡®ä¿æ•°æ®åº“å·²åˆ›å»º

### Whisper è½¬å½•å¤±è´¥
- æ£€æŸ¥ Whisper æ¨¡å‹æ–‡ä»¶è·¯å¾„
- éªŒè¯ FFmpeg æ˜¯å¦å®‰è£…
- ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´

### GPT-4 ç« èŠ‚ç”Ÿæˆå¤±è´¥
- éªŒè¯ Azure OpenAI é…ç½®
- æ£€æŸ¥ API å¯†é’¥æ˜¯å¦æœ‰æ•ˆ
- æŸ¥çœ‹æ˜¯å¦æœ‰ API é…é¢é™åˆ¶

### é€šçŸ¥å‘é€å¤±è´¥
- æ£€æŸ¥é€šçŸ¥æœåŠ¡çš„ token é…ç½®
- éªŒè¯ç½‘ç»œè¿æ¥
- æŸ¥çœ‹æœåŠ¡ç«¯æ—¥å¿—

## ğŸ“ å¼€å‘è¯´æ˜

### é¡¹ç›®ç»“æ„
```
video-chapter-generator/
â”œâ”€â”€ db/                 # æ•°æ®åº“ç›¸å…³
â”‚   â””â”€â”€ database.js     # æ•°æ®åº“è¿æ¥å’ŒæŸ¥è¯¢
â”œâ”€â”€ public/             # å‰ç«¯æ–‡ä»¶
â”‚   â”œâ”€â”€ index.html      # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ styles.css      # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ app.js          # å‰ç«¯é€»è¾‘
â”œâ”€â”€ scripts/            # å·¥å…·è„šæœ¬
â”‚   â””â”€â”€ init-db.js      # æ•°æ®åº“åˆå§‹åŒ–
â”œâ”€â”€ services/           # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ whisper.js      # Whisper é›†æˆ
â”‚   â”œâ”€â”€ gpt-chapter.js  # GPT-4 é›†æˆ
â”‚   â”œâ”€â”€ notification.js # é€šçŸ¥æœåŠ¡
â”‚   â””â”€â”€ export.js       # å¯¼å‡ºæœåŠ¡
â”œâ”€â”€ uploads/            # ä¸Šä¼ æ–‡ä»¶ç›®å½•
â”œâ”€â”€ temp/               # ä¸´æ—¶æ–‡ä»¶ç›®å½•
â”œâ”€â”€ exports/            # å¯¼å‡ºæ–‡ä»¶ç›®å½•
â”œâ”€â”€ server.js           # ä¸»æœåŠ¡å™¨
â”œâ”€â”€ package.json        # ä¾èµ–é…ç½®
â”œâ”€â”€ .env.example        # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ README.md           # è¯´æ˜æ–‡æ¡£
```

### æ·»åŠ æ–°åŠŸèƒ½
1. åç«¯ APIï¼šåœ¨ `server.js` ä¸­æ·»åŠ è·¯ç”±
2. æ•°æ®åº“æ“ä½œï¼šåœ¨ `db/database.js` ä¸­æ·»åŠ æŸ¥è¯¢æ–¹æ³•
3. å‰ç«¯ç•Œé¢ï¼šåœ¨ `public/index.html` å’Œ `public/app.js` ä¸­å®ç°

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ‘¨â€ğŸ’» ä½œè€…

è§†é¢‘ç« èŠ‚ç”Ÿæˆå™¨å¼€å‘å›¢é˜Ÿ

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

**äº«å—ä½¿ç”¨ AI é©±åŠ¨çš„è§†é¢‘ç« èŠ‚ç”Ÿæˆï¼** ğŸ¬âœ¨
