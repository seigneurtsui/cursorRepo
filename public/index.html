<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>视频章节生成器 - Video Chapter Generator</title>
  <link rel="stylesheet" href="/public/styles.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <h1>🎬 视频章节生成器</h1>
        <p class="subtitle">AI驱动的视频时间轴自动生成工具</p>
      </div>
      <div class="header-stats" id="headerStats">
        <div class="stat-item">
          <span class="stat-label">账户余额</span>
          <span class="stat-value" id="userBalance" style="color: #28a745;">¥0.00</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">总视频</span>
          <span class="stat-value" id="totalVideos">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">总章节</span>
          <span class="stat-value" id="totalChapters">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">处理中</span>
          <span class="stat-value processing" id="processingCount">0</span>
        </div>
        <div class="stat-item">
          <button onclick="window.location.href='/public/profile.html'" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer;">
            👤 会员中心
          </button>
          <button onclick="logout()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; margin-left: 10px;">
            🚪 退出
          </button>
        </div>
      </div>
    </header>

    <!-- Upload Section -->
    <section class="upload-section">
      <div class="upload-area" id="uploadArea">
        <input type="file" id="fileInput" accept="video/*" multiple hidden>
        <div class="upload-icon">📹</div>
        <h3>上传视频文件</h3>
        <p>点击或拖拽视频文件到此区域</p>
        <p class="upload-hint">支持 MP4, AVI, MKV, MOV, FLV, WMV, WebM 等格式</p>
        <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
          选择文件
        </button>
      </div>

      <!-- File List -->
      <div id="selectedFiles" class="selected-files"></div>

      <!-- Upload Button -->
      <div id="uploadActions" class="upload-actions" style="display: none;">
        <button class="btn btn-success" id="uploadBtn">
          <span class="btn-icon">⬆️</span> 开始上传
        </button>
        <button class="btn btn-secondary" id="clearBtn">
          <span class="btn-icon">🗑️</span> 清空列表
        </button>
      </div>
    </section>

    <!-- Search and Filter Section -->
    <section class="filter-section">
      <div class="filter-controls">
        <div class="filter-group">
          <label>🔍 关键字搜索</label>
          <input type="text" id="searchKeyword" placeholder="输入文件名关键字...">
        </div>
        
        <div class="filter-group">
          <label>📊 状态筛选</label>
          <select id="filterStatus">
            <option value="">全部状态</option>
            <option value="uploaded">已上传</option>
            <option value="processing">处理中</option>
            <option value="completed">已完成</option>
            <option value="error">错误</option>
          </select>
        </div>

        <div class="filter-group">
          <label>📅 开始日期</label>
          <input type="date" id="filterStartDate">
        </div>

        <div class="filter-group">
          <label>📅 结束日期</label>
          <input type="date" id="filterEndDate">
        </div>

        <div class="filter-group">
          <button class="btn btn-primary" id="searchBtn">
            <span class="btn-icon">🔍</span> 搜索
          </button>
          <button class="btn btn-secondary" id="resetBtn">
            <span class="btn-icon">↻</span> 重置
          </button>
        </div>
        
        <!-- Admin Only: Member Account Explorer Button -->
        <div class="filter-group" id="memberExplorerGroup" style="display: none;">
          <button class="btn btn-info" id="memberExplorerBtn" onclick="openMemberExplorer()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600;">
            <span class="btn-icon">👥</span> 会员账户探索
          </button>
        </div>
      </div>
    </section>
    
    <!-- Member Explorer Modal (Admin Only) -->
    <div id="memberExplorerModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center;">
      <div style="background: white; padding: 30px; border-radius: 15px; max-width: 900px; width: 90%; max-height: 85vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #667eea; padding-bottom: 15px;">
          <h2 style="margin: 0; color: #667eea;">👥 会员账户探索器</h2>
          <button onclick="closeMemberExplorer()" style="background: none; border: none; font-size: 28px; cursor: pointer; color: #999;">&times;</button>
        </div>
        
        <div style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); border-radius: 10px; border-left: 4px solid #667eea;">
          <div style="display: flex; gap: 15px; margin-bottom: 10px;">
            <input type="text" id="memberSearchInput" placeholder="🔍 搜索用户名或邮箱..." style="flex: 1; padding: 10px 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;" onkeyup="filterMemberList()">
            <select id="memberStatusFilter" onchange="filterMemberList()" style="padding: 10px 15px; border: 2px solid #ddd; border-radius: 8px; min-width: 150px;">
              <option value="">全部状态</option>
              <option value="active">✅ 已激活</option>
              <option value="inactive">❌ 已禁用</option>
            </select>
          </div>
          <div style="font-size: 13px; color: #666;">
            <span id="memberCountDisplay">加载中...</span>
          </div>
        </div>
        
        <div id="memberListContainer" style="min-height: 300px;">
          <div style="text-align: center; padding: 40px; color: #999;">
            <div style="font-size: 48px; margin-bottom: 10px;">⏳</div>
            <div>正在加载会员列表...</div>
          </div>
        </div>
      </div>
    </div>

  <!-- Export Section -->
  <section class="export-section">
    <h3>📤 导出数据</h3>
    <div style="margin-bottom: 15px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
      <span id="selectedCount" style="font-weight: bold;">已选择 0 个视频</span>
      <button class="btn btn-secondary" onclick="selectAllVideos()" style="margin-left: 10px; padding: 5px 10px; font-size: 13px;">
        全选
      </button>
      <button class="btn btn-secondary" onclick="clearSelection()" style="margin-left: 5px; padding: 5px 10px; font-size: 13px;">
        清空选择
      </button>
    </div>
    <div class="export-buttons">
      <button class="btn btn-export" onclick="exportData('excel')">
        <span class="btn-icon">📊</span> Excel
      </button>
      <button class="btn btn-export" onclick="exportData('csv')">
        <span class="btn-icon">📄</span> CSV
      </button>
      <button class="btn btn-export" onclick="exportData('html')">
        <span class="btn-icon">🌐</span> HTML
      </button>
      <button class="btn btn-export" onclick="exportData('pdf')">
        <span class="btn-icon">📕</span> PDF
      </button>
      <button class="btn btn-export" onclick="exportData('markdown')">
        <span class="btn-icon">📝</span> Markdown
      </button>
    </div>
    <div class="export-buttons" style="margin-top: 15px; border-top: 2px solid #ddd; padding-top: 15px;">
      <button class="btn btn-export" onclick="batchDownloadTranscripts()" style="background: #28a745;">
        <span class="btn-icon">📝</span> 批量下载字幕
      </button>
      <button class="btn btn-export" onclick="batchExportCustomExcel()" style="background: #17a2b8;">
        <span class="btn-icon">📊</span> 批量导出定制EXCEL
      </button>
    </div>
  </section>

    <!-- Progress Section -->
    <section class="progress-section" id="progressSection" style="display: none;">
      <h3>⚙️ 处理进度</h3>
      <div id="currentProcessingInfo" style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <strong style="color: #007bff;">正在处理：</strong>
            <span id="currentVideoName" style="font-weight: 500;">无</span>
            <span id="currentVideoIndex" style="margin-left: 10px; color: #6c757d;"></span>
          </div>
          <div style="display: flex; align-items: center; gap: 20px;">
            <div>
              <strong style="color: #28a745;">累计用时：</strong>
              <span id="totalProcessingTime" style="font-size: 18px; font-weight: 600; color: #28a745;">00:00:00</span>
            </div>
          </div>
        </div>
      </div>
      <div id="progressContainer"></div>
    </section>

    <!-- Video List Section -->
    <section class="video-list-section">
      <div class="section-header">
        <h3>📹 视频列表</h3>
        <div class="pagination-controls">
          <!-- Admin Only: User Filter -->
          <div id="adminUserFilterContainer" style="display: none; margin-right: 15px;">
            <label style="margin-right: 5px;">👤 会员筛选：</label>
            <select id="adminUserFilter" style="padding: 8px 12px; border-radius: 5px; border: 1px solid #ddd; min-width: 200px;">
              <option value="">全部会员</option>
            </select>
            <button class="btn btn-success" onclick="exportAllUsersVideos()" style="margin-left: 10px; padding: 8px 16px; font-size: 14px;">
              📥 导出全部会员视频Excel
            </button>
          </div>
          
          <label>每页显示：</label>
          <select id="pageSize">
            <option value="10">10</option>
            <option value="20" selected>20</option>
            <option value="30">30</option>
            <option value="50">50</option>
            <option value="100">100</option>
            <option value="ALL">全部</option>
          </select>
        </div>
      </div>

      <div id="videoList" class="video-list">
        <div class="loading">加载中...</div>
      </div>

      <!-- Pagination -->
      <div class="pagination" id="pagination"></div>
    </section>
  </div>

  <!-- Modal for video details -->
  <div id="videoModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <div id="modalContent"></div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <script src="/public/auth-helper.js"></script>
  <script src="/public/app.js"></script>
</body>
</html>
